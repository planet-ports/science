<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8" /><title>14&nbsp;Unsafe Operations Utilities</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="racket.css" title="default" /><link rel="stylesheet" type="text/css" href="scribble-style.css" title="default" /><script type="text/javascript" src="scribble-common.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x"><span style="font-weight: bold">Science Collection:</span> Reference Manual</a></td></tr></table></div><div class="tocviewsublistonly" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="introduction.html" class="tocviewlink" data-pltdoc="x">Introduction</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="using.html" class="tocviewlink" data-pltdoc="x">Using the Science Collection</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="error-handling.html" class="tocviewlink" data-pltdoc="x">Error Handling</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="mathematical-functions.html" class="tocviewlink" data-pltdoc="x">Mathematical Functions</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="special-functions.html" class="tocviewlink" data-pltdoc="x">Special Functions</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="random-numbers.html" class="tocviewlink" data-pltdoc="x">Random Number Generation</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="random-distributions.html" class="tocviewlink" data-pltdoc="x">Random Number Distributions</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="statistics.html" class="tocviewlink" data-pltdoc="x">Statistics</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="histograms.html" class="tocviewlink" data-pltdoc="x">Histograms</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="ode.html" class="tocviewlink" data-pltdoc="x">Ordinary Differential Equations</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="chebyshev.html" class="tocviewlink" data-pltdoc="x">Chebyshev Approximations</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="fft.html" class="tocviewlink" data-pltdoc="x">Fast Fourier Transforms</a></td></tr><tr><td align="right">13&nbsp;</td><td><a href="physical-constants.html" class="tocviewlink" data-pltdoc="x">Physical Constants</a></td></tr><tr><td align="right">14&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Unsafe Operations Utilities</a></td></tr><tr><td align="right">15&nbsp;</td><td><a href="gfdl.html" class="tocviewlink" data-pltdoc="x">GNU Free Documentation License</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" data-pltdoc="x">Bibliography</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><a href="#(def._((planet._unsafe-ops-utils..rkt._(williams._science..plt._4._7))._real-~3efloat))" class="tocsublink" data-pltdoc="x"><span title="Provided from: (planet williams/science/unsafe-ops-utils)"><span class="RktSym">real-<wbr></wbr>&gt;float</span></span></a></td></tr><tr><td><a href="#(def._((planet._unsafe-ops-utils..rkt._(williams._science..plt._4._7))._real-vector-~3efloat-vector))" class="tocsublink" data-pltdoc="x"><span title="Provided from: (planet williams/science/unsafe-ops-utils)"><span class="RktSym">real-<wbr></wbr>vector-<wbr></wbr>&gt;float-<wbr></wbr>vector</span></span></a></td></tr><tr><td><a href="#(def._((planet._unsafe-ops-utils..rkt._(williams._science..plt._4._7))._real-vector-~3eflvector))" class="tocsublink" data-pltdoc="x"><span title="Provided from: (planet williams/science/unsafe-ops-utils)"><span class="RktSym">real-<wbr></wbr>vector-<wbr></wbr>&gt;flvector</span></span></a></td></tr><tr><td><a href="#(form._((planet._unsafe-ops-utils..rkt._(williams._science..plt._4._7))._with-fixed))" class="tocsublink" data-pltdoc="x"><span title="Provided from: (planet williams/science/unsafe-ops-utils)"><span class="RktSym">with-<wbr></wbr>fixed</span></span></a></td></tr><tr><td><a href="#(form._((planet._unsafe-ops-utils..rkt._(williams._science..plt._4._7))._with-float))" class="tocsublink" data-pltdoc="x"><span title="Provided from: (planet williams/science/unsafe-ops-utils)"><span class="RktSym">with-<wbr></wbr>float</span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft">&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="physical-constants.html" title="backward to &quot;13 Physical Constants&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Science Collection: Reference Manual&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="gfdl.html" title="forward to &quot;15 GNU Free Documentation License&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>14<tt>&nbsp;</tt><a name="(part._unsafe-ops-utils)"></a><a name="(mod-path._(planet._williams/science/unsafe-ops-utils))"></a>Unsafe Operations Utilities</h3><p>All functions and forms provided by <span class="RktSym">racket</span> check their arguments to ensure that the arguments conform to contracts and other constraints. For example, <span class="RktSym"><a href="/servlets/doc-search.rkt?tag=KCgzKSAwICgpIDAgKCkgKCkgKHEgZGVmICgocXVvdGUgIyVrZXJuZWwpIHZlY3Rvci1yZWYp%0D%0AKSk%3D%0D%0A" class="RktValLink" data-pltdoc="x">vector-ref</a></span> checks its arguments to ensure that the first argument is a vector, that the second argument is an exact integer, and that the second argument is between <span style="font-style: italic"></span>0<span style="font-style: italic"></span> and one less than the vector&#8217;s length, inclusive.</p><p>Functions provided by <span class="RktSym">racket/unsafe/ops</span> are unsafe. They have certain constraints, but the constraints are not checked, which allows the system to generate and execute faster code. If arguments violate an unsafe function&#8217;s constraints, the function&#8217;s behavior and result is unpredictable, and the entire system can crash or become corrupted.</p><p>For efficiency, the Science Collection often uses unsafe operations internally &#8212;<wbr></wbr> particularly for computationally intensive operations. However, the combination unchecked operations, which bypass contract checks, and unsafe operations could result in the consequences described above. The Science Collection protects its uses of unsafe arithmetic operations using the functions and macros described in this chapter. They are described here so that user code can, in turn, use similar protections.</p><p>The functions and macros described in the chapter can be made available using the form:</p><p><table cellspacing="0" class="defmodule"><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="/servlets/doc-search.rkt?tag=KCgzKSAwICgpIDAgKCkgKCkgKHEgZm9ybSAoKGxpYiAicmFja2V0L3ByaXZhdGUvYmFzZS5y%0D%0Aa3QiKSByZXF1aXJlKSkp%0D%0A" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="/servlets/doc-search.rkt?tag=KCgzKSAwICgpIDAgKCkgKCkgKHEgZm9ybSAoKGxpYiAicmFja2V0L3ByaXZhdGUvYmFzZS5y%0D%0Aa3QiKSBwbGFuZXQpKSk%3D%0D%0A" class="RktStxLink" data-pltdoc="x">planet</a></span><span class="stt"> </span><span class="RktSym">williams/science/unsafe-ops-utils</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></p><p>These routines are used to assure that a real variable (or vector) is represented as a floating-point number &#8212;<wbr></wbr> called an inexact-real in Racket. This can be used to protect code that uses the new unsafe floating-point operations.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((planet._unsafe-ops-utils..rkt._(williams._science..plt._4._7))._real-~3efloat))"></a><span title="Provided from: (planet williams/science/unsafe-ops-utils)"><span class="RktSym">real-&gt;float</span></span><span class="hspace">&nbsp;</span><span class="RktVar">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="/servlets/doc-search.rkt?tag=KCgzKSAwICgpIDAgKCkgKCkgKHEgZGVmICgocXVvdGUgIyVrZXJuZWwpIGluZXhhY3QtcmVh%0D%0AbD8pKSk%3D%0D%0A" class="RktValLink" data-pltdoc="x">inexact-real?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">x</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="/servlets/doc-search.rkt?tag=KCgzKSAwICgpIDAgKCkgKCkgKHEgZGVmICgocXVvdGUgIyVrZXJuZWwpIHJlYWw%2FKSkp%0D%0A" class="RktValLink" data-pltdoc="x">real?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns an inexact real (i.e., a float) given a real <span class="RktVar">x</span>. Raises an error if <span class="RktVar">x</span> is not a real. This can be used to insure a real value is a float, even in unsafe code.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((planet._unsafe-ops-utils..rkt._(williams._science..plt._4._7))._real-vector-~3efloat-vector))"></a><span title="Provided from: (planet williams/science/unsafe-ops-utils)"><span class="RktSym">real-vector-&gt;float-vector</span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">vector-of</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="/servlets/doc-search.rkt?tag=KCgzKSAwICgpIDAgKCkgKCkgKHEgZGVmICgocXVvdGUgIyVrZXJuZWwpIGluZXhhY3QtcmVh%0D%0AbD8pKSk%3D%0D%0A" class="RktValLink" data-pltdoc="x">inexact-real?</a></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">vector-of</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="/servlets/doc-search.rkt?tag=KCgzKSAwICgpIDAgKCkgKCkgKHEgZGVmICgocXVvdGUgIyVrZXJuZWwpIHJlYWw%2FKSkp%0D%0A" class="RktValLink" data-pltdoc="x">real?</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a vector of inexact reals (i.e., floats) given a vector of reals, <span class="RktVar">v</span>. Raises an error if any element of <span class="RktVar">v</span> is not a real.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((planet._unsafe-ops-utils..rkt._(williams._science..plt._4._7))._real-vector-~3eflvector))"></a><span title="Provided from: (planet williams/science/unsafe-ops-utils)"><span class="RktSym">real-vector-&gt;flvector</span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">flvector?</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">vector-of</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="/servlets/doc-search.rkt?tag=KCgzKSAwICgpIDAgKCkgKCkgKHEgZGVmICgocXVvdGUgIyVrZXJuZWwpIHJlYWw%2FKSkp%0D%0A" class="RktValLink" data-pltdoc="x">real?</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns an flvector (i.e., floats) given a vector of reals, <span class="RktVar">v</span>. Raises an error if any element of <span class="RktVar">v</span> is not a real.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><table cellspacing="0" class="RktBlk RForeground"><tr><td><span class="RktPn">(</span><a name="(form._((planet._unsafe-ops-utils..rkt._(williams._science..plt._4._7))._with-fixed))"></a><span title="Provided from: (planet williams/science/unsafe-ops-utils)"><span class="RktSym">with-fixed</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">x</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Executes the <span class="RktVar">expr</span>s with each <span class="RktVar">x</span> guaranteed to the a fixed integer. All of the <span class="RktVar">x</span>s must be identifiers.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><table cellspacing="0" class="RktBlk RForeground"><tr><td><span class="RktPn">(</span><a name="(form._((planet._unsafe-ops-utils..rkt._(williams._science..plt._4._7))._with-float))"></a><span title="Provided from: (planet williams/science/unsafe-ops-utils)"><span class="RktSym">with-float</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">x</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Executes the <span class="RktVar">expr</span>s with each <span class="RktVar">x</span> guaranteed to the a float. All of the <span class="RktVar">x</span>s must be identifiers.</div></p><div class="navsetbottom"><span class="navleft">&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="physical-constants.html" title="backward to &quot;13 Physical Constants&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Science Collection: Reference Manual&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="gfdl.html" title="forward to &quot;15 GNU Free Documentation License&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>